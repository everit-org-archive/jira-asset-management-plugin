<style type="text/css">
	#parse("css/main.css")
</style>
	<form action="/secure/JiraAssetsRegisterSearchWebAction.jspa?search=true">
		#parse("templates/includes/plugin_head.vm")
		<div id="assets_registry_content" class="assets_registry_content rounded grid">
			#parse("templates/includes/horizentalMenu.vm")
			<div class="gadget-container">
				<h3 id="gadget-10001-title" class="dashboard-item-title">$i18n.getText("search.title.main")</h3>
				<div style="padding: 10px 10px 10px 10px;">
					<div class="gadget-container">
						<h3 id="gadget-10001-title" class="dashboard-item-title">$i18n.getText("search.title.serach")</h3>
						<div class="dashboard-item-content">
							<table id="search-table" cellspacing="0" cellpadding="2" class="basic-search-table">
								<tbody>
									<tr></tr>
									#foreach ($field in $requiredFields)
										<tr>
										#if($field.fieldName.equals($FIELD_NAME_ASSIGNEE))
											<td><label>$i18n.getText("device.label.assignee")<label></td>
											<td>
												<select name="$FIELD_NAME_ASSIGNEE" id="$FIELD_NAME_ASSIGNEE">
													<option value="">$i18n.getText("search.any.assignee")</option>
												#foreach ($assignee in $assignees)
										    		<option value="$assignee.name">$assignee.displayName</option>
										    	#end
												</select>
											</td
										#elseif($field.active)
											<td><label>$field.fieldName<label></td>
											<td><input type="text" name="$field.fieldName"/></td>
										#end
										</tr>
									#end
									<tr>
										<td><label>$i18n.getText("search.status")<label></td>
										<td>
											<select name="status01">
												<option value="">$i18n.getText("search.any.status")</option>
											#foreach ($status in $statuses)
									    		<option value="$status.statusName">$status.statusName</option>
									    	#end
											</select>
										</td
									</tr>
									<tr>
										<td><label>$i18n.getText("search.comment")<label></td>
										<td><input type="text" name="comment01"/></td
									</tr>
								<tbody>
							</table>
						</div>
					</div>
					<br/>
					<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js" type="text/javascript"></script>
					<script type='text/javascript'>
						function DropDown(el) {
							this.dd = el;
							this.initEvents();
						}
						DropDown.prototype = {
							initEvents : function() {
								var obj = this;
			
								obj.dd.on('click', function(event){
									$(this).toggleClass('active');
									event.stopPropagation();
								});	
							}
						}
			
						$(function() {
			
							var dd = new DropDown( $('#dd') );
			
							$(document).click(function() {
								// all dropdowns
								$('.dropdown-menu').removeClass('active');
							});
			
						});
						
						function addRow(fieldKey, fieldName) {
							var table = document.getElementById('search-table');
							var tbody = table.getElementsByTagName("tbody")[0];
							var rowCount = table.rows.length;
        					var row = tbody.insertRow(rowCount);
        					row.id = fieldKey + '_tr';
        					
        					var cell1 = row.insertCell(0);
        					var element1 = document.createElement("label");
        					var id = fieldName + "_VALUE";
        					element1.setAttribute("for", id);
        					element1.innerHTML= fieldName;
        					cell1.appendChild(element1);
        					
        					var cell2 = row.insertCell(1);
        					var element2 = document.createElement("input");
        					element2.type = "text";
        					console.log("fieldName: "+fieldName);
        					element2.name = fieldName;
        					console.log("fieldNamess: "+fieldName);
        					element2.setAttribute("id", id);
        					cell2.appendChild(element2);
        					var deleteLiId = '#' + fieldKey;
        					$(deleteLiId).remove();
            					
            				var cell3 = row.insertCell(2);
            				var element3 = document.createElement("a");
            				var onclickAttribute = 'deleteRow("' + fieldKey + '", "' + fieldName + '")';
            				element3.setAttribute("onclick", onclickAttribute);
            				var classVar = 'ui-icon icon-trash';
            				element3.setAttribute("class", classVar);
            				var titleVar = '$i18n.getText("icon.remove")';
            				element3.setAttribute("title", titleVar);
            				cell3.appendChild(element3);
            				
        					tbody.appendChild(row);
        					console.log("ADDROW fieldkey: "+fieldKey+". fieldName: "+fieldName);
						}
						
						function deleteRow(fieldKey, fieldName) {
							if(fieldName != "Custom") {
								var deleteRowId = '#' + fieldKey + '_tr';
								$(deleteRowId).remove();
								var ul = document.getElementById('dropdown-list');
								var newLI = document.createElement("li");
								newLI.setAttribute("id", fieldKey);
								var onclickAttr = 'addRow("' + fieldKey + '","' + fieldName +'\")';
								var a = document.createElement("a");
								a.setAttribute("onclick", onclickAttr);
								a.innerHTML = fieldName; 
								newLI.appendChild(a);
								ul.appendChild(newLI);
							}
						}
					</script>
					<div style="padding: 0px 0px 20px 0px">
						<div style="float: left">
							<div id="dd" class="dropdown-menu" tabindex="1" style="padding-bottom: 20px">
							    <span class="btn">$i18n.getText("search.button.add.more.fields")</span>
							    <ul id="dropdown-list" class="dropdown">
							    	#foreach ($field in $optionalFields)
						    			<li id="key_$field.id"><a onclick="addRow('key_$field.id', '$field.fieldName')">$field.fieldName</a></li>
							    	#end
							    </ul>
							</div>
						</div>
						<div style="float: right">
							 <input id="submit"  type="submit" name="submit_search" value="$i18n.getText('search.button.search')" class="btn">
						</div>
					</div>
					<div style="clear: both">
					</div>
					#if($search)
					<div class="gadget-container">
						<h3 id="gadget-10001-title" class="dashboard-item-title">$i18n.getText("search.title.results")</h3>
						<div class="dashboard-item-content">
							#if($searchedAssets.empty)
								<div class="messages-info">
									$i18n.getText("search.no.result")
								</div>
							#else
							<table cellspacing="0" cellpadding="2" class="basic-content-table">
								<thead>
									<tr>
										<th width="100px">$i18n.getText("table.issue.id")</th>
										<th>$i18n.getText("table.device.name")</th>
										<th width="125px">$i18n.getText("table.assignee")</th>
										<th width="125px">$i18n.getText("table.status")</th>
										<th width="175px">$i18n.getText("table.action")</th>
									</tr>
								</thead>
								<tbody>
								#foreach ($asset in $searchedAssets)
									<tr>
										<td><a href="/browse/$asset.issueKey" class="issue-link">$asset.issueKey</a></td>
										<td>$asset.deviceName</td>
										<td><a href="/secure/ViewProfile.jspa?name=$asset.assignee.name" class="issue-link">$asset.assignee.displayName</a></td>
										<td>$asset.status</td>
										<td>
											<a href="/secure/JiraAssetsRegisterAssetDetailsWebAction!default.jspa?actionName=$actionViewDetails&issueKey=$asset.issueKey&backPageUrl=$backButtonValue" class="ui-icon icon-information" title="$i18n.getText("icon.info")"></a>
										#if($asset.status.equals($statusOpenName) && $asset.loggedUserIsAssignee)
											<a href="/secure/JiraAssetsRegisterAssetDetailsWebAction!default.jspa?actionName=$actionEdtiDetails&issueKey=$asset.issueKey&backPageUrl=$backButtonValue" class="ui-icon icon-edit" title="$i18n.getText("icon.edit")"></a>
											<a href="/secure/JiraAssetsRegisterMyAssetsWebAction!default.jspa?change=true&issueKey=$asset.issueKey&actionName=$actionInternalHandover&backPageUrl=$backButtonValue" class="ui-icon icon-internal-assignee" title="$i18n.getText("icon.internal.assignee")"></a>
											<a href="/secure/JiraAssetsRegisterMyAssetsWebAction!default.jspa?change=true&issueKey=$asset.issueKey&actionName=$actionExternalHandover&backPageUrl=$backButtonValue" class="ui-icon icon-external-assignee" title="$i18n.getText("icon.external.assignee")"></a>
											<a href="/secure/JiraAssetsRegisterMyAssetsWebAction!default.jspa?change=true&issueKey=$asset.issueKey&actionName=$actionDisposeAsset&backPageUrl=$backButtonValue" class="ui-icon icon-culling" title="$i18n.getText("icon.culling")"></a>
										#elseif($asset.status.equals($statusInternalAssignedName) && $asset.loggedUserIsAssignee)
												<a href="/secure/JiraAssetsRegisterMyAssetsWebAction!default.jspa?change=true&issueKey=$asset.issueKey&actionName=$actionAcceptance&backPageUrl=$backButtonValue" class="ui-icon icon-accept" title="$i18n.getText("icon.accept")"></a>
												<a href="/secure/JiraAssetsRegisterMyAssetsWebAction!default.jspa?change=true&issueKey=$asset.issueKey&actionName=$actionRejection&backPageUrl=$backButtonValue" class="ui-icon icon-reject" title="$i18n.getText("icon.reject")"></a>
										#elseif($asset.status.equals($statusExternalAssignedName) && $asset.loggedUserIsAssignee && $asset.loggedUserIsReporter) 
												<a href="/secure/JiraAssetsRegisterMyAssetsWebAction!default.jspa?change=true&issueKey=$asset.issueKey&actionName=$actionReagain&backPageUrl=$backButtonValue" class="ui-icon icon-recover" title="$i18n.getText("icon.recover")"></a>
										#elseif($asset.status.equals($statusInternalAssignedName) && ($asset.loggedUserIsReporter || $asset.loggedUserIsPreviousAssigned))
												<a href="/secure/JiraAssetsRegisterMyAssetsWebAction!default.jspa?change=true&issueKey=$asset.issueKey&actionName=$actionWithdrawal&backPageUrl=$backButtonValue" class="ui-icon icon-reject" title="$i18n.getText("icon.withdraw")"></a>
										#end
										</td>
									</tr>
								#end
								</tbody>
							</table>
							#end
						</div>
					</div>
					<br/>
					#end
				</div>
			</div>
		</div>
	</form>
